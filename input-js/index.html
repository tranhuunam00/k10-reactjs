<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <form id="form" action="">
      <div class="divUserName">
        <h4>UserName</h4>
        <input
          id="username"
          type="text"
          name="username"
          id=""
          placeholder="username"
          valid="required|minLength:6|maxLength:12"
        />
        <p id="errorUserName" style="color: red"></p>
      </div>

      <div class="divPassword">
        <h4>Password</h4>
        <input
          id="password"
          type="text"
          name="password"
          id=""
          placeholder="password"
        />
        <p id="errorPassword" style="color: red"></p>
      </div>

      <div class="divSex">
        <h4>Sex</h4>
        <label for="">Male</label> <input id="male" name="sex" type="radio" />
        <label for="">FE_MALE</label>
        <input id="female" name="sex" type="radio" checked="true" />
        <p id="errorSex" style="color: red"></p>
      </div>

      <div class="divDob">
        <h4>Dob</h4>
        <input id="dOB" type="date" name="dOB" id="" />
        <p id="errorDob" style="color: red"></p>
      </div>

      <div class="divEmail">
        <h4>email</h4>
        <input id="email" type="text" name="email" id="" placeholder="email" />
        <p id="errorEmail" style="color: red"></p>
      </div>

      <button id="submit" disabled type="submit">nut</button>
    </form>
  </body>
  <script>
    const nameEle = document.getElementById("username");
    const passwordEle = document.getElementById("password");
    const emailEle = document.getElementById("email");
    const dOBEle = document.getElementById("dOB");
    const sexEle = document.getElementById("sex");
    const buttonELe = document.getElementById("submit");
    const formELe = document.getElementById("form");
    const maleELe = document.getElementById("male");
    const femaleELe = document.getElementById("female");

    const ERROR_CHECK_LIST_TYPE = {
      required: "Bạn cần nhập trường ",
      minLength: "yêu cầu tối thiểu cho ",
      maxLength: "yêu cầu tối data cho ",
      dataType: "dataType",
      min: "min",
      max: "max",
      format: "format",
    };
    const parseValid = (validString) => {
      if (!validString) return {};

      // b1 tach chuoi theo  "|"
      const arrayError = validString.split("|");
      // b2 lap qua tung phan
      return arrayError.reduce((pre, cur) => {
        // b3 tach theo ":"
        const [key, value = true] = cur.split(":");
        // b4 nhet vao object
        return { ...pre, [key]: value };
      }, {});
    };
    const validate = (type = "username", value, listError = {}) => {
      console.log(listError);
      let error = null;

      for (let key in listError) {
        switch (key) {
          case "required":
            error = !value ? ERROR_CHECK_LIST_TYPE[key] : null;
            break;
          case "minLength":
            error =
              value.length < +listError[key]
                ? ERROR_CHECK_LIST_TYPE[key] + listError[key] + " kí tự"
                : null;
            break;
          case "maxLength":
            error =
              value.length > +listError[key]
                ? ERROR_CHECK_LIST_TYPE[key] + listError[key] + " kí tự"
                : null;
            break;
        }
        if (error) {
          break;
        }
      }
      console.log(error);
      return error;
    };

    const checkSubmit = () => {
      if (
        listError.userName ||
        listError.password ||
        listError.dob ||
        listError.sex ||
        listError.email ||
        !formValue.userName ||
        !formValue.dob ||
        !formValue.sex ||
        !formValue.email ||
        !formValue.password
      ) {
        buttonELe.setAttribute("disabled", "true");
      } else {
        buttonELe.removeAttribute("disabled");
      }
    };

    const listError = {
      userName: null,
      dob: null,
      sex: null,
      password: null,
      email: null,
    };

    const formValue = {
      userName: null,
      dob: null,
      sex: null,
      password: null,
      email: null,
    };

    formELe.addEventListener("submit", (e) => {
      e.preventDefault();
    });

    // gắn 1 sự kiện vào thẻ input của username
    nameEle.addEventListener("keyup", (event) => {
      const { name, value, checked } = event.target;
      formValue.userName = value;

      // get element
      const divUserName = document.querySelector(".divUserName");
      const pErrorEle = divUserName.querySelector("#errorUserName");

      // check dk
      const valid = nameEle.getAttribute("valid");
      const validObject = parseValid(valid);
      const error = validate(name, value, validObject);

      if (error) {
        pErrorEle.innerText = error;
        listError.userName = error;
      } else {
        pErrorEle.innerText = "";
        listError.userName = null;
      }
      checkSubmit();
    });

    passwordEle.addEventListener("keyup", (event) => {
      const { name, value, checked } = event.target;
      formValue.password = value;

      // get element
      const divUserName = document.querySelector(".divPassword");
      const pErrorEle = divUserName.querySelector("#errorPassword");

      // check dk
      if (!value || value.length < 6) {
        pErrorEle.innerText = "ban hay nhap 6 ki tu";
        listError.password = "ban hay nhap 6 ki tu";
      } else {
        pErrorEle.innerText = "";
        listError.password = null;
      }
      checkSubmit();
    });

    emailEle.addEventListener("keyup", (event) => {
      const { name, value, checked } = event.target;
      formValue.email = value;

      // get element
      const divUserName = document.querySelector(".divEmail");
      const pErrorEle = divUserName.querySelector("#errorEmail");

      // check dk
      if (!value || value.length < 6) {
        pErrorEle.innerText = "ban hay nhap 6 ki tu";
        listError.email = "ban hay nhap 6 ki tu";
      } else {
        pErrorEle.innerText = "";
        listError.email = null;
      }
      checkSubmit();
    });

    maleELe.addEventListener("click", (event) => {
      const { name, value, checked } = event.target;
      formValue.sex = checked;
      checkSubmit();
    });

    femaleELe.addEventListener("click", (event) => {
      const { name, value, checked } = event.target;
      formValue.sex = checked;
      checkSubmit();
    });

    dOBEle.addEventListener("change", (event) => {
      const { name, value, checked } = event.target;
      formValue.dob = new Date(value).getTime();

      // get element
      const divUserName = document.querySelector(".divDob");
      const pErrorEle = divUserName.querySelector("#errorDob");
      // check dk
      if (!value || new Date(value).getTime() > new Date().getTime() - 2000) {
        pErrorEle.innerText = "nhap nho hon bay h";
        listError.dob = "ban hay nhap 6 ki tu";
      } else {
        pErrorEle.innerText = "";
        listError.dob = null;
      }
      checkSubmit();
    });
  </script>
</html>
